<div class="page">
  <!-- Demo banner -->
  <mat-card class="demo-banner" *ngIf="demo()">
    <mat-icon aria-hidden="true">warning_amber</mat-icon>
    <div>
      <strong>Demo mode:</strong>
      The charts and tables below use example data only and do not reflect real bets.
    </div>
  </mat-card>

  <!-- Filters -->
  <div class="filters">
    <mat-chip-listbox aria-label="Sport filter">
      <mat-chip-option
        *ngFor="let s of data.sports"
        [selected]="sport() === s"
        (click)="setSport(s)">{{ s }}</mat-chip-option>
    </mat-chip-listbox>

    <mat-button-toggle-group [value]="mode()" (valueChange)="mode.set($event)">
      <mat-button-toggle value="Single">Single</mat-button-toggle>
      <mat-button-toggle value="SGP">SGP</mat-button-toggle>
      <mat-button-toggle value="SGP+">SGP+</mat-button-toggle>
    </mat-button-toggle-group>
  </div>

  <!-- Model cards -->
  <div class="grid">
    <mat-card *ngFor="let m of summaries()">
      <div class="card-head">
        <div class="title">{{ m.name }}</div>
        <a [routerLink]="['/models', m.id]" mat-icon-button aria-label="Details">
          <mat-icon>open_in_new</mat-icon>
        </a>
      </div>

      <div class="stats">
        <div><span>All-time W/L</span><strong>{{ m.all_wl }}</strong></div>
        <div>
          <span>All-time ROI</span>
          <strong [class.pos]="m.all_roi>=0" [class.neg]="m.all_roi<0">{{ m.all_roi }}%</strong>
        </div>
      </div>

      <mat-checkbox
        [checked]="selectedIds().has(m.id)"
        (change)="toggleModel(m.id, $event.checked)">
        Include in chart
      </mat-checkbox>
    </mat-card>
  </div>

  <!-- Chart (demo-only series) -->
  <div class="section">
    <h3>Cumulative % Gain (L14D)</h3>
    <div class="chart-wrap" *ngIf="isBrowser">
      <canvas
        baseChart
        [data]="lineCfg().data"
        [options]="lineCfg().options"
        [type]="lineCfg().type">
      </canvas>
    </div>
  </div>

  <table mat-table [dataSource]="recent()" class="mat-elevation-z1 w-full">

    <!-- Date -->
    <ng-container matColumnDef="date">
      <th mat-header-cell *matHeaderCellDef>Date</th>
      <td mat-cell *matCellDef="let row">{{ row.date | date:'MMM d, y, h:mm a' }}</td>
    </ng-container>

    <!-- Model -->
    <ng-container matColumnDef="model">
      <th mat-header-cell *matHeaderCellDef>Model</th>
      <td mat-cell *matCellDef="let row">{{ row.modelName }}</td>
    </ng-container>

    <!-- Sport -->
    <ng-container matColumnDef="sport">
      <th mat-header-cell *matHeaderCellDef>Sport</th>
      <td mat-cell *matCellDef="let row">{{ row.sport }}</td>
    </ng-container>

    <!-- Event -->
    <ng-container matColumnDef="event">
      <th mat-header-cell *matHeaderCellDef>Event</th>
      <td mat-cell *matCellDef="let row">{{ row.event }}</td>
    </ng-container>

    <!-- Type -->
    <ng-container matColumnDef="type">
      <th mat-header-cell *matHeaderCellDef>Type</th>
      <td mat-cell *matCellDef="let row">{{ row.betType }}</td>
    </ng-container>

    <!-- Odds -->
    <ng-container matColumnDef="odds">
      <th mat-header-cell *matHeaderCellDef>Odds</th>
      <td mat-cell *matCellDef="let row">{{ row.combinedOdds }}</td>
    </ng-container>

    <!-- Grade controls -->
    <ng-container matColumnDef="grade">
      <th mat-header-cell *matHeaderCellDef>Grade</th>
      <td mat-cell *matCellDef="let row">
        <mat-chip-set class="grade-set">
          <mat-chip
            class="grade-chip win"
            [class.is-selected]="row.result === 'win'"
            (click)="grade(row, 'win')"
            selectable="false"
            aria-pressed="{{ row.result === 'win' }}"
            title="Mark as Win"
          >Win</mat-chip>

          <mat-chip
            class="grade-chip loss"
            [class.is-selected]="row.result === 'loss'"
            (click)="grade(row, 'loss')"
            selectable="false"
            aria-pressed="{{ row.result === 'loss' }}"
            title="Mark as Loss"
          >Loss</mat-chip>

          <mat-chip
            class="grade-chip push"
            [class.is-selected]="row.result === 'push'"
            (click)="grade(row, 'push')"
            selectable="false"
            aria-pressed="{{ row.result === 'push' }}"
            title="Mark as Push"
          >Push</mat-chip>

          <mat-chip
            class="grade-chip clear"
            [class.is-selected]="!row.result"
            (click)="grade(row, '')"
            selectable="false"
            aria-pressed="{{ !row.result }}"
            title="Clear result"
          >Clear</mat-chip>
        </mat-chip-set>
      </td>
    </ng-container>

    <!-- Result units -->
    <ng-container matColumnDef="result">
      <th mat-header-cell *matHeaderCellDef>Result</th>
      <td mat-cell *matCellDef="let row">
        <span [ngClass]="resultClass(row)">
          {{ formatUnits(row) }}
        </span>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>

</div>
