<div class="page">
  <a routerLink="/" class="back"><mat-icon>arrow_back</mat-icon> Back</a>

  <!-- Stats banner -->
  <div class="stats-banner">
    <mat-card class="card" *ngFor="let item of [
      {label:'L14 W/L',  val: stats.l14_wl},
      {label:'L14 ROI',  val: (stats.l14_roi + '%')},
      {label:'All-time W/L',val: stats.all_wl},
      {label:'All-time ROI',val: (stats.all_roi + '%')},
      {label:'Avg SGP odds',val: stats.avgSgpOdds},
      {label:'Hit rate', val: (stats.hitRate + '%')},
      {label:'Max drawdown', val: (stats.maxDrawdown + '%')},
      {label:'Longest streaks', val: ('W'+stats.longestWin + ' / L'+stats.longestLoss)}
    ]">
      <div class="label">{{ item.label }}</div>
      <div class="value">{{ item.val }}</div>
    </mat-card>
  </div>

  <!-- Equity curve -->
  <div class="section">
    <h3>Equity curve (last N bets)</h3>
    <div class="chart-wrap" *ngIf="isBrowser">
      <canvas baseChart [data]="chartCfg.data" [options]="chartCfg.options" [type]="chartCfg.type"></canvas>
    </div>
  </div>

  <!-- Bet log -->
  <div class="section header-row">
    <h3>Bet log</h3>
    <button mat-stroked-button (click)="exportCSV()"><mat-icon>download</mat-icon> Export CSV</button>
  </div>
  <table mat-table [dataSource]="log" class="mat-elevation-z1">
    <ng-container matColumnDef="date"><th mat-header-cell *matHeaderCellDef>Date</th><td mat-cell *matCellDef="let r">{{ r.date | date:'MMM d, HH:mm' }}</td></ng-container>
    <ng-container matColumnDef="sport"><th mat-header-cell *matHeaderCellDef>Sport</th><td mat-cell *matCellDef="let r">{{ r.sport }}</td></ng-container>
    <ng-container matColumnDef="event"><th mat-header-cell *matHeaderCellDef>Event</th><td mat-cell *matCellDef="let r">{{ r.event }}</td></ng-container>
    <ng-container matColumnDef="betType"><th mat-header-cell *matHeaderCellDef>Market</th><td mat-cell *matCellDef="let r">{{ r.betType }}</td></ng-container>
    <ng-container matColumnDef="combinedOdds"><th mat-header-cell *matHeaderCellDef>Odds</th><td mat-cell *matCellDef="let r">{{ r.combinedOdds }}</td></ng-container>
    <ng-container matColumnDef="resultUnits"><th mat-header-cell *matHeaderCellDef>Result (u)</th><td mat-cell *matCellDef="let r"><span [class.pos]="r.resultUnits>=0" [class.neg]="r.resultUnits<0">{{ r.resultUnits | number:'1.2-2' }}</span></td></ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
</div>
