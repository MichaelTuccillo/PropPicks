<mat-toolbar class="app-toolbar" color="transparent">
  <!-- Brand -->
  <a class="brand" (click)="goHome()" role="button">Mr. Prop Bot</a>

  <span class="spacer"></span>

  <!-- When signed in -->
  <ng-container *ngIf="auth.isAuthed(); else guest">
    <a mat-button routerLink="/dashboard" routerLinkActive="active">Dashboard</a>
    <a mat-button routerLink="/generate" routerLinkActive="active">Generate Bets</a>

    <!-- Account icon opens menu -->
    <button
      mat-icon-button
      [matMenuTriggerFor]="accountMenu"
      aria-label="Account menu">
      <mat-icon>account_circle</mat-icon>
    </button>

    <!-- keep BOTH attrs to cover different Material versions -->
    <mat-menu #accountMenu="matMenu" panelClass="solid-menu" overlayPanelClass="solid-menu">

      <!-- OPAQUE BACKGROUND LAYER (not focusable / not clickable) -->
      <div class="menu-solid-bg" aria-hidden="true"></div>

      <!-- Header row -->
      <div mat-menu-item class="user-item" (click)="$event.stopPropagation()" tabindex="-1">
        <mat-icon>person</mat-icon>
        <span>{{ auth.user()?.displayName || auth.user()?.email }}</span>
      </div>

      <mat-divider></mat-divider>

      <button mat-menu-item (click)="onSignOut()">
        <mat-icon>logout</mat-icon>
        <span>Sign out</span>
      </button>
    </mat-menu>

    <!-- Theme toggle (optional) -->
    <button mat-icon-button *ngIf="theme" (click)="theme.toggle()" aria-label="Toggle theme">
      <mat-icon>{{ theme.isDark() ? 'light_mode' : 'dark_mode' }}</mat-icon>
    </button>
  </ng-container>

  <!-- Guest -->
  <ng-template #guest>
    <a mat-button routerLink="/sign-in" routerLinkActive="active">Sign in</a>
    <a mat-stroked-button routerLink="/sign-up" routerLinkActive="active">Create account</a>
    <button mat-icon-button *ngIf="theme" (click)="theme.toggle()" aria-label="Toggle theme">
      <mat-icon>{{ theme.isDark() ? 'light_mode' : 'dark_mode' }}</mat-icon>
    </button>
  </ng-template>
</mat-toolbar>

<router-outlet />
